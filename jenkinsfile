podTemplate(
    label: 'apipoi',
    containers: [
        containerTemplate(name: 'az', image: 'microsoft/azure-cli:2.0.41', ttyEnabled: true, command: 'cat'),
    ]
) {
    node('apipoi'){
        stage('API-Poi-CI') {
            git 'https://github.com/Azure-Samples/openhack-devops-team.git'
            container('az'){
                stage('Docker Build POI API') {
                    withCredentials([azureServicePrincipal('otaprdspn')]) {
                        sh """
                        az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID
                        az acr build --registry ohdrteam04acr -f Dockerfile --image apiuser ./apis/poi/web
                        """
                    }
                }
            }
        }
    }
}